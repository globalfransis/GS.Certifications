@page
@using Socios.Web.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject IConfiguration Configuration
@using System.Web;
@using Microsoft.Extensions.Configuration
@using Socios.Web.Areas.Security.Pages
@model StepperModel

@{
    Layout = null;
}

@* <!DOCTYPE html>
<html lang="en" class="login">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="~/favicon.png" />
    <link href="~/lib/twitter-bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/main.css" asp-append-version="true" />
    <script src="https://kit.fontawesome.com/b39e955174.js" crossorigin="anonymous"></script>
    <script src="~/lib/jquery/jquery.min.js"></script>
    <style>
        .loading {
            display: flex;
            justify-content: center;
        }

        .loading--full-height {
            align-items: center;
            height: 100%;
        }

        .loading::after {
            content: "";
            width: 100px;
            height: 100px;
            border: 10px solid #dddddd;
            border-top-color: #50b5da;
            border-radius: 50%;
            transform: rotate(0.16turn);
            animation: loading 1s ease infinite;
            left: 50%;
            top: 50%;
            display: block;
            position: absolute;
            z-index: 999;
        }

        @@keyframes loading {
            /* Safari support */
            from {
                transform: rotate(0turn);
            }

            to {
                transform: rotate(1turn);
            }
        }

        #top {
            z-index: 999;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: none;
            position: absolute;
            background-color: #50b5da;
            color: #aaaaaa;
            opacity: .4;
            filter: alpha(opacity=30);
        }

        #layoutbody.active {
            opacity: 0.5;
            pointer-events: none;
            z-index: 999 !important;
        }

        .dropdown-item {
            width: 500px !important;
        }

        .fondo {
            background: url('@Url.Content("~/img/login-background1.png")') no-repeat center;
            background-size: cover;
            /* min-height: auto; */
            /* border-radius: 0 10px 10px 0; */
            padding: 0;
            /*position: absolute;*/
            top: 0;
            bottom: 0;
            right: 0;
            float: left;
        }

        @@media (max-width: 1000px) {
            .fondo {
                /*width: 10%;*/
                max-width: 100%;
                height: auto;
                background: none;
                background-size: contain;
                /*Sin imagen*/
                /*max-width: 0%;
                                                                height: 0%;*/
            }

                .fondo div {
                    margin: 0 10px
                }
        }
    </style>
</head>

<body id="layoutbody">

    <div class="top" id="spinner" style="display:none">
        <div class="loading loading--full-height"></div>
    </div>

    <div class="container-fluid">
        <div class="row h-75">
            <div class="justify-content-center">
                <form method="post" action="" style="background-color: transparent;">



                    <div class="form-group col-12 text-center">
                        <h2 class="login-main-text pb-2">Stepper</h2>
                    </div>

                    <div>
                        <label for="UsuarioEmpresaPortalId">Empresa:</label>
                        <select id="UsuarioEmpresaPortalId" name="UsuarioEmpresaPortalId">
                            <option value="">Seleccione una empresa</option>
                            @foreach (var uep in Model.UsuarioEmpresasPortales)
                            {
                                <option value="@uep.Id">@uep.EmpresaPortal.RazonSocial | @uep.EmpresaPortal.Company.BusinessName</option>
                            }
                        </select>
                    </div>

                    <!-- Botón de ingreso -->
                    <div>
                        <button type="submit"
                                tabindex="0"
                                class="btn btn-primary w-100 login-submit-button"
                                onclick="RedirectToOption(0, 0, '/index')">
                            Ingresar @(Model.UsuarioEmpresasPortales.Count)
                        </button>
                    </div>

                    <input type="hidden" asp-for="UserId">
                    <input type="hidden" asp-for="UsuarioEmpresasPortalesSerialized" />
                    <input type="hidden" asp-for="UserCompaniesSerialized" />

                </form>
            </div>
        </div>
    </div>

    <script src="~/lib/jquery/jquery.min.js" asp-append-version="true"></script>
    <script src="~/js/Generic.js" asp-append-version="true"></script>
    <script>
        $(document).ready(function () {
            $(".login-submit-button").on("click", function () {
                showSpinner(true);
            });
        });
    </script>
</body>
</html> *@




<!DOCTYPE html>

<html lang="en" class="login">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@HttpUtility.HtmlDecode(Configuration.GetSection("Application").GetValue(typeof(string), "Name").ToString()) - @ViewBag.Title</title>
    <link rel="icon" type="image/x-icon" href="~/favicon.png" />
    <link href="~/lib/twitter-bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    @*<link  rel="stylesheet" href="~/css/bootstrap-small.css" />*@
    <link rel="stylesheet" href="~/css/main.css" asp-append-version="true" />
    <script src="https://kit.fontawesome.com/b39e955174.js" crossorigin="anonymous"></script>
    <script src="~/lib/jquery/jquery.min.js"></script>
    <script src="~/js/menu.js" asp-append-version="true"></script>
    <style>
        .loading {
            display: flex;
            justify-content: center;
        }

        .loading--full-height {
            align-items: center;
            height: 100%;
        }

        .loading::after {
            content: "";
            width: 100px;
            height: 100px;
            border: 10px solid #dddddd;
            border-top-color: #50b5da;
            border-radius: 50%;
            transform: rotate(0.16turn);
            animation: loading 1s ease infinite;
            left: 50%;
            top: 50%;
            display: block;
            position: absolute;
            z-index: 999;
        }

        @@keyframes loading {
            /* Safari support */
            from {
                transform: rotate(0turn);
            }

            to {
                transform: rotate(1turn);
            }
        }

        #top {
            z-index: 999;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: none;
            position: absolute;
            background-color: #50b5da;
            color: #aaaaaa;
            opacity: .4;
            filter: alpha(opacity=30);
        }

        #layoutbody.active {
            opacity: 0.5;
            pointer-events: none;
            z-index: 999 !important;
        }

        .dropdown-item {
            width: 500px !important;
        }

        .fondo {
            background: url('@Url.Content("~/img/login-background1.png")') no-repeat center;
            background-size: cover;
            /* min-height: auto; */
            /* border-radius: 0 10px 10px 0; */
            padding: 0;
            /*position: absolute;*/
            top: 0;
            bottom: 0;
            right: 0;
            float: left;
        }

        @@media (max-width: 1000px) {
            .fondo {
                /*width: 10%;*/
                max-width: 100%;
                height: auto;
                background: none;
                background-size: contain;
                /*Sin imagen*/
                /*max-width: 0%;
                                                                height: 0%;*/
            }

                .fondo div {
                    margin: 0 10px
                }
        }
    </style>
</head>
<body id="layoutbody">
    <div class="top" id="spinner" style="display:none">
        <div class="loading loading--full-height"></div>
    </div>
    <div class="container-fluid">
        <div class="row h-75">
            <div class="col-lg-6 col-sm-12 col-12 col-md-12 d-flex welcome-login-container fondo">
                <div class="row">
                    <div class="px-5 pt-5 mt-5">
                    </div>

                </div>

            </div>

            <div class="col-lg-6 col-sm-12 vcenter d-flex align-items-center justify-content-center "
                 style="background-color: #FEFEFE;">

                <div class="col-lg-8 col-xl-6 col-sm-12 col-md-8 col-12 p-4">
                    <div class="justify-content-center">
                        <div style="display:flex; justify-content:center">
                        </div>

                        <div class="col-lg-12" style="position:relative">
                            <hr />
                            <h1 class="welcome-login">
                                Portal de Socios
                            </h1>
                            <form method="post" action="" style="background-color: transparent;">

                                <div class="form-group col-12 text-center">
                                    <h2 class="pb-2">Selección de Socio</h2>
                                </div>

                                <div class="form-group col-12">
                                    <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                                </div>

                                <div class="form-group col-12 d-flex justify-content-center">
                                    <div class="col-12 mb-4">
                                        <label class="col-form-label login-side-text" placeholder="Default input" asp-for="CompanyId">Empresa</label>
                                        <div>
                                            <select id="CompanyId" name="" class="form-control" placeholder="Seleccione el Socio" autofocus>
                                                <option value="">Seleccione una Empresa</option>
                                                @foreach (var uep in Model.Companies)
                                                {
                                                    <option value="@uep.Id">@uep.BusinessName </option>
                                                }
                                            </select>
                                        </div>
                                        <span asp-validation-for="CompanyId" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="form-group col-12 d-flex justify-content-center">
                                    <div class="col-12 mb-4">
                                        <label class="col-form-label login-side-text" placeholder="Default input" asp-for="UsuarioEmpresaPortalId">Socio</label>
                                        <div>
                                            <select id="UsuarioEmpresaPortalId" name="UsuarioEmpresaPortalId" class="form-control" placeholder="Seleccione el Socio" autofocus>
                                                <option value="">Seleccione un Socio</option>
                                            </select>
                                        </div>
                                        <span asp-validation-for="UsuarioEmpresaPortalId" class="text-danger"></span>
                                    </div>
                                </div>



                                <div class="form-group col-12 text-center">
                                    <div class="col-12 p-0 mb-3">
                                        <button type="submit" asp-page-handler="" tabindex="0" class="login-side-text btn btn-primary w-100 login-submit-button" onclick="RedirectToOption(0, 0, '/index')">Ingresar</button>
                                    </div>
                                </div>

                            </form>

                        </div>
                    </div>

                    <div class="login-side-text">
                        <environment exclude="Production">
                            <div class="" style="font-size:14px"> (Entorno: @Model.WebHostEnvironment.EnvironmentName)</div>
                        </environment>
                    </div>

                </div>

            </div>


        </div>
    </div>


    <script src="~/lib/jquery/jquery.min.js" asp-append-version="true"></script>
    <script src="~/lib/twitter-bootstrap/js/bootstrap.bundle.min.js" asp-append-version="true"></script>
    <script src="~/lib/twitter-bootstrap/js/bootstrap.bundle.min.js" asp-append-version="true"></script>
    <script src="~/js/localStorage.js" asp-append-version="true"></script>
    <script src="~/js/Generic.js" asp-append-version="true"></script>
    <script>
        $(document).ready(function () {
            clearLocalStorage();

            $(".login-submit-button").on("click", function () {
                showSpinner(true);
            });

            $("#CompanyId").change(function () {
                var CompanyId = $(this).val();
                // Realizamos la llamada AJAX solo si se selecciona una categoría
                if (CompanyId) {
                    $.ajax({
                        url: '@Url.Page(null, new { handler = "EmpresasPortales" })',
                        type: 'GET',
                        data: { CompanyId: CompanyId },
                        success: function (data) {
                            var $subcategory = $("#UsuarioEmpresaPortalId");
                            $subcategory.empty(); // Limpiar opciones anteriores
                            $subcategory.append('<option value="">Seleccione un Socio</option>');

                            // Agregar cada opción retornada
                            $.each(data, function (i, item) {
                                $subcategory.append('<option value="' + item.key + '">' + item.value + '</option>');
                            });
                        },
                        error: function () {
                            console.error("Error al cargar las subcategorías.");
                        }
                    });
                } else {
                    // Si no se selecciona ninguna categoría, limpiar el combo de subcategorías
                    $("#UsuarioEmpresaPortalId").empty();
                    $("#UsuarioEmpresaPortalId").append('<option value="">Seleccione un Socio</option>');
                }
            });
        });
    </script>
</body>
</html>

